<!doctype html>

<html class="no-js" lang="en">

<head>


	<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

	Pedro Simões

	Simples Theme by https://jekyllthemes.io
	Premium + free Jekyll themes for your blog or website.

	- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->


	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<!-- Page Info -->
	<link rel="shortcut icon" href="/images/seomis.jpg">
	<title>My Advent Of Rust, Day 4 – Pedro Simões</title>
	<meta name="description" content="Notes on day 4 of advent of code made in Rust.">

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="My Advent Of Rust, Day 4 – Pedro Simões">
	<meta name="twitter:description" content="Notes on day 4 of advent of code made in Rust.">
	<meta name="twitter:image:src" content="http://localhost:4000/images/advent-of-rust/advent_of_rust.png">

	<!-- Facebook OpenGraph -->
	<meta property="og:title" content="My Advent Of Rust, Day 4 – Pedro Simões" />
	<meta property="og:description" content="Notes on day 4 of advent of code made in Rust." />
	<meta property="og:image" content="http://localhost:4000/images/advent-of-rust/advent_of_rust.png" />

	
	<!-- Font Embed Code -->
	<link href="https://fonts.googleapis.com/css?family=Nunito:300,400,400i,600" rel="stylesheet">
	

	<!-- Styles -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/css/style.css">
	
	<!-- Icons -->
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/solid.js" integrity="sha384-GXi56ipjsBwAe6v5X4xSrVNXGOmpdJYZEEh/0/GqJ3JTHsfDsF8v0YQvZCJYAiGu" crossorigin="anonymous"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/brands.js" integrity="sha384-0inRy4HkP0hJ038ZyfQ4vLl+F4POKbqnaUB6ewmU4dWP0ki8Q27A0VFiVRIpscvL" crossorigin="anonymous"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/fontawesome.js" integrity="sha384-NY6PHjYLP2f+gL3uaVfqUZImmw71ArL9+Roi9o+I4+RBqArA2CfW1sJ1wkABFfPe" crossorigin="anonymous"></script>

	
	<!-- Custom Styles -->
	<style></style>
	

	
	<!-- Analytics Code -->
	
	

	
	<!-- Extra Header JS Code -->
	
	
	
</head>


<body class="loading ajax-loading" data-site-url="http://localhost:4000" data-page-url="/blog/my-advent-of-rust-day-4">


	<header class="header">

	<div class="wrap">

		
		<a href="/" class="header__avatar">
			<img src="/images/seomis.jpg" class="header__avatar__img">
		</a>
		

		
		<a href="/" class="header__title">
			Pedro Simões
		</a>
		

		<p class="header__tagline">Following curiosity.</p>

		<div class="menu">
			<ul class="menu__list">
				
				<li class="menu__list__item">
					<a href="/" class="menu__list__item__link">Latest</a>
				</li>
				
				<li class="menu__list__item">
					<a href="/about" class="menu__list__item__link">About</a>
				</li>
				
			</ul>
		</div>

	</div>

</header>


	<div class="loader"><svg width="120" height="30" viewBox="0 0 120 30" xmlns="http://www.w3.org/2000/svg"><circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" /></circle><circle cx="60" cy="15" r="9" fill-opacity="0.3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="0.5" to="0.5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite" /></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" /></circle></svg></div>

	<div class="page-loader"></div>

	
	<div class="page">

		<div class="page__content" data-page-title="My Advent Of Rust, Day 4 – Pedro Simões">

			<section class="single">

	<div class="wrap">

		<h1>My Advent Of Rust, Day 4</h1>
		<p class="subtitle">13 December 2020</p>

		<p><img src="/images/advent-of-rust/advent_of_rust.png" alt="" /></p>

<h1 id="ive-always-considered-programming-challenges-a-fun-way-of-experimenting-new-languages">I’ve always considered programming challenges a fun way of experimenting new languages.</h1>

<p>For this edition of advent of code (2020), i decided i would give <a href="https://www.rust-lang.org/">Rust</a> a try.</p>

<p>Rust really makes your head spin a bit with supposedly trivial problems (and this is a good thing!).</p>

<p>This is mainly because programming in <strong>Rust requires you to think differently</strong>.</p>

<p>Replicating patterns that are common in other languages is tricky and sometimes quite hard or even impossible.</p>

<p>Day 4 was a good example, so let’s examine the <a href="https://adventofcode.com/2020/day/4">challenge</a>, which i will try to resume:</p>

<ul>
  <li>You have a big string input, containing representations of passports.</li>
  <li>On double newline, you have a passport.</li>
  <li>Each <strong>valid</strong> passport consists of the following fields: “byr”, “iyr”, “eyr”, “hgt”, “hcl”, “ecl”, “pid”.</li>
  <li>Find all valid passports.</li>
</ul>

<p>We’ll, first lets transform the input into something useful. This is the “similar” part of the Rust code to the rest of the other languages.</p>

<p>I’m sure there would be many ways of doing this but i have chosen:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">let</span> <span class="n">result</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="s">"input_day_four.txt"</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
 <span class="k">let</span> <span class="n">passports</span> <span class="o">=</span> <span class="n">result</span><span class="nf">.split</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
</code></pre></div></div>

<p>so i have copied the input into a file (as a noobie, i prefered not to perform an http request :p ), read it to a String (unwrap to obtain the string is unsafe an discouraged, i know. but since i am controling the input, it is sufficient) and then split it to obtain each passport.</p>

<p>Why not doing it in one line like :</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="k">let</span> <span class="n">passports</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;&amp;</span><span class="nb">str</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="s">"input_day_four.txt"</span><span class="p">)</span>
        <span class="nf">.unwrap</span><span class="p">()</span>
        <span class="nf">.split</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>
<p>Well… because using <strong>unwrap creates a temporary which is freed while still in use</strong>. And in Rust this means that i need to create a new variable if i want to continue.</p>

<p>So how do i verify which passports are valid?</p>

<p>Using a language like <a href="https://golang.org/">Go</a>, i would probably loop the separated strings, find the index of <code class="highlighter-rouge">:</code> and then try to delete an entry using the index. Then i would assert if the len of the map was equal to zero. If yes, then it is a valid passport. That could be represented as such:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">validPassportCounter</span> <span class="o">:=</span> <span class="m">0</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">passport</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">passports</span> <span class="p">{</span>
	<span class="n">control</span> <span class="o">:=</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">struct</span><span class="p">{}{</span>
		<span class="s">"byr"</span><span class="o">:</span> <span class="k">struct</span><span class="p">{}{},</span>
		<span class="s">"iyr"</span><span class="o">:</span> <span class="k">struct</span><span class="p">{}{},</span>
		<span class="s">"eyr"</span><span class="o">:</span> <span class="k">struct</span><span class="p">{}{},</span>
		<span class="s">"hgt"</span><span class="o">:</span> <span class="k">struct</span><span class="p">{}{},</span>
		<span class="s">"hcl"</span><span class="o">:</span> <span class="k">struct</span><span class="p">{}{},</span>
		<span class="s">"ecl"</span><span class="o">:</span> <span class="k">struct</span><span class="p">{}{},</span>
		<span class="s">"pid"</span><span class="o">:</span> <span class="k">struct</span><span class="p">{}{},</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ch</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">passport</span> <span class="p">{</span>
		<span class="k">if</span> <span class="n">ch</span> <span class="o">==</span> <span class="sc">':'</span> <span class="p">{</span>
		  	<span class="nb">delete</span><span class="p">(</span><span class="n">control</span><span class="p">,</span> <span class="n">passport</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="m">3</span><span class="o">:</span><span class="n">i</span><span class="p">])</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">control</span><span class="p">)</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
		<span class="n">validPassportCounter</span><span class="o">++</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>another way would be to split whitespace an find the strings starting with the desired fields like so:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">validPassportCounter</span> <span class="o">:=</span> <span class="m">0</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">passport</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">passports</span> <span class="p">{</span>
        <span class="n">control</span> <span class="o">:=</span> <span class="m">0</span>
	<span class="n">fields</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">Fields</span><span class="p">(</span><span class="n">passport</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">field</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">fields</span> <span class="p">{</span>
		<span class="k">if</span> <span class="n">strings</span><span class="o">.</span><span class="n">HasPrefix</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s">"byr"</span><span class="p">)</span> <span class="o">||</span> <span class="n">strings</span><span class="o">.</span><span class="n">HasPrefix</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s">"iyr"</span><span class="p">)</span> <span class="o">||</span>
			 <span class="n">strings</span><span class="o">.</span><span class="n">HasPrefix</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s">"eyr"</span><span class="p">)</span> <span class="o">||</span> <span class="n">strings</span><span class="o">.</span><span class="n">HasPrefix</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s">"hgt"</span><span class="p">)</span> <span class="o">||</span> 				<span class="n">strings</span><span class="o">.</span><span class="n">HasPrefix</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s">"hcl"</span><span class="p">)</span> <span class="o">||</span>
				<span class="n">strings</span><span class="o">.</span><span class="n">HasPrefix</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s">"ecl"</span><span class="p">)</span> <span class="o">||</span> <span class="n">strings</span><span class="o">.</span><span class="n">HasPrefix</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s">"pid"</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">control</span><span class="o">++</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="n">control</span> <span class="o">==</span> <span class="m">7</span> <span class="p">{</span>
		<span class="n">validPassportCounter</span><span class="o">++</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Using these patterns proved to be quite challenging in Rust. I kept fighting the compiler, and the compiler kept winning.</p>

<blockquote>
  <p>So i went back to sketching… what was i really trying to do?</p>
</blockquote>

<p>I have a vector of references to strings to which i wanted to filter the ones containing the right values and then count the collected values.</p>

<p>Looking at <a href="https://doc.rust-lang.org/std/iter/struct.Filter.html#method.count">Iter</a> i found that using an iterator i could <a href="https://doc.rust-lang.org/std/iter/struct.Filter.html">filter</a> elements with a predicate and then <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.count">count</a> the filtered entries.</p>

<p>Horaay!</p>

<p>So i am on to something. I wrote:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">valid_passports</span> <span class="o">=</span> <span class="n">passports</span>
        <span class="nf">.filter</span><span class="p">()</span>
        <span class="nf">.count</span><span class="p">();</span>
</code></pre></div></div>
<p>So now i only need a predicate that filters the strings i need!</p>

<p>the predicate could be similar to the second golang approach:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">check_validity_part_1</span><span class="p">(</span><span class="n">passport</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
	<span class="k">let</span> <span class="n">fields</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="s">"byr"</span><span class="p">,</span> <span class="s">"iyr"</span><span class="p">,</span> <span class="s">"eyr"</span><span class="p">,</span> <span class="s">"hgt"</span><span class="p">,</span> <span class="s">"hcl"</span><span class="p">,</span> <span class="s">"ecl"</span><span class="p">,</span> <span class="s">"pid"</span><span class="p">];</span>
	<span class="n">fields</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.all</span><span class="p">(|</span><span class="n">field</span><span class="p">|</span> <span class="p">{</span>
		<span class="n">passport</span>
		<span class="nf">.split_ascii_whitespace</span><span class="p">()</span>
		<span class="nf">.any</span><span class="p">(|</span><span class="n">passport_field</span><span class="p">|</span> <span class="n">passport_field</span><span class="nf">.starts_with</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
	<span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>
<p>so again i ask for my new BFF <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html">Iterator</a>, which holds an <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.all">all</a> method that tests if every element of passport verifies a predicate.</p>

<p>The predicate i want is for each <strong>field of a passport</strong>, determine if the passport_field starts with any of the values of <strong>fields</strong>.</p>

<p>For that, i’ve use a  <a href="https://doc.rust-lang.org/std/primitive.str.html#method.split_ascii_whitespace">split_ascii_whitespace</a> to obtain the passport fields, and <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.any">any</a> to verify passport correctness.</p>

<p>Voila!</p>

<p>Now gluing it all together…  <strong>it compiles!!!!! YES!! We are the champions!!!!</strong></p>

<p>i just had to make every passport pass the predicate <strong>check_validity_part_1</strong> that i wrote previously:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">result</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="s">"input_day_four.txt"</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>

<span class="k">let</span> <span class="n">passports</span> <span class="o">=</span> <span class="n">result</span><span class="nf">.split</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>

<span class="k">let</span> <span class="n">valid_passports</span> <span class="o">=</span> <span class="n">passports</span>
        <span class="nf">.filter</span><span class="p">(|</span><span class="n">passport</span><span class="p">|</span> <span class="nf">check_validity_part_1</span><span class="p">(</span><span class="n">passport</span><span class="p">))</span>
        <span class="nf">.count</span><span class="p">();</span>

<span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">valid_passports</span><span class="p">);</span>
</code></pre></div></div>
<p>and this piece gives the correct input to the first challenge of the 4 day :)</p>

<hr />

<blockquote>
  <p>Some lessons to myself: don’t fight the compiler. If your approach/pattern is not working, it is probably because you probably cannot use this same pattern using Rust. Stop, re-evaluate, read the documentation, and surely you’ll find a way of solving the problem.</p>
</blockquote>

<h3 id="if-this-was-the-optimal-approach-well-that-should-be-re-evaluated-once-i-have-a-better-knowledge-of-rust-">If this was the optimal approach… well, that should be re-evaluated, once i have a better knowledge of Rust :)</h3>

<p>This blog was originally posted on <a href="https://seomisw.medium.com/my-advent-of-rust-day-4-bc3a9e76a85b" target="_blank">Medium</a>–be sure to follow and clap!</p>



	</div>

</section>

		</div>

	</div>


	<footer class="footer">

	<ul class="socials">
	
	
	
	
	<li class="socials__item">
	
		<a href="https://twitter.com/seomisw" target="_blank" class="socials__item__link" title="Twitter">
			<i class="fab fa-twitter" aria-hidden="true"></i>
		</a>
	</li>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
	
		<a href="https://github.com/psimoesSsimoes" target="_blank" class="socials__item__link" title="Github">
			<i class="fab fa-github" aria-hidden="true"></i>
		</a>
	</li>
	
	
	
	
	<li class="socials__item">
	
		<a href="https://www.reddit.com/user/seomisS" target="_blank" class="socials__item__link" title="Reddit">
			<i class="fab fa-reddit" aria-hidden="true"></i>
		</a>
	</li>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
	
		<a href="https://seomis.cc/feed.xml" target="_blank" class="socials__item__link" title="Rss">
			<i class="fas fa-rss" aria-hidden="true"></i>
		</a>
        
	
	
</ul>


	<div class="footer__copyright">
		<span>© 2021 Pedro Simões</span>
	</div>

</footer>



	<!-- Javascript Assets -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="/js/plugins-min.js"></script>
	<script src="/js/simples-min.js"></script>

	
	<!-- Extra Footer JS Code -->
	
	


</body>

</html>